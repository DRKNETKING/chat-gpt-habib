<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>habibiDWL AI - Professional Reggae Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --reggae-green: #1b5e20;
            --reggae-yellow: #fbc02d;
            --reggae-red: #b71c1c;
            --reggae-accent: #f9a825;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            overscroll-behavior-y: contain;
            background-color: #f8fafc;
        }

        .dark body {
            background-color: #020617;
        }

        /* Running Cards Animation */
        .card-carousel {
            display: flex;
            overflow: hidden;
            width: 100%;
            padding: 10px 0;
            background: rgba(255, 255, 255, 0.5);
        }
        .dark .card-carousel { background: rgba(15, 23, 42, 0.5); }

        .card-track {
            display: flex;
            gap: 15px;
            animation: scrollCards 25s linear infinite;
        }

        @keyframes scrollCards {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .info-card {
            flex: 0 0 200px;
            padding: 12px;
            border-radius: 16px;
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .dark .info-card {
            background: #1e293b;
            border-color: #334155;
        }

        .chat-container {
            height: calc(100vh - 240px); /* Adjusted for carousel */
            scroll-behavior: smooth;
        }

        .reggae-gradient-text {
            background: linear-gradient(90deg, var(--reggae-green), var(--reggae-yellow), var(--reggae-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* Message Bubbles */
        .animate-pop {
            animation: popMsg 0.4s cubic-bezier(0.26, 1.36, 0.4, 1) forwards;
        }

        @keyframes popMsg {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .glass-ui {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .dark .glass-ui {
            background: rgba(15, 23, 42, 0.9);
        }

        /* Pulse for Voice */
        .pulse-red {
            box-shadow: 0 0 0 0 rgba(183, 28, 28, 0.7);
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(183, 28, 28, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(183, 28, 28, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(183, 28, 28, 0); }
        }
    </style>
</head>
<body class="dark:text-white transition-colors duration-300">

    <!-- Sidebar -->
    <div id="sidebar" class="fixed inset-0 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="toggleSidebar()"></div>
        <div class="relative w-80 h-full bg-white dark:bg-slate-900 shadow-2xl p-6 flex flex-col">
            <div class="flex items-center justify-between mb-8 border-b pb-4 dark:border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-green-600 via-yellow-400 to-red-600 flex items-center justify-center text-white font-bold">H</div>
                    <h2 class="text-xl font-bold tracking-tight">habibiDWL AI</h2>
                </div>
                <button onclick="toggleSidebar()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            
            <button onclick="window.location.reload()" class="flex items-center justify-center gap-3 w-full p-4 rounded-2xl bg-gradient-to-r from-green-600 to-green-700 text-white font-bold hover:shadow-lg transition mb-6">
                <i class="fas fa-plus"></i>
                <span>Sesi Baru</span>
            </button>

            <div class="flex-1 overflow-y-auto space-y-3" id="history">
                <p class="text-[10px] uppercase font-bold text-gray-400 px-2">Percakapan Terakhir</p>
                <!-- History Items can go here -->
            </div>

            <div class="mt-auto pt-4 border-t dark:border-slate-800">
                <div class="bg-gray-50 dark:bg-slate-800 p-3 rounded-xl flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-reggae-yellow flex items-center justify-center text-black font-bold">U</div>
                    <div class="text-xs">
                        <p class="font-bold">Pengguna VIP</p>
                        <p class="opacity-60 italic">"Good Vibes Only"</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="fixed top-0 inset-x-0 h-16 z-40 glass-ui flex items-center justify-between px-5 border-b dark:border-slate-800">
        <button onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition">
            <i class="fas fa-align-left text-reggae-green text-lg"></i>
        </button>
        
        <div class="flex flex-col items-center">
            <h1 class="reggae-gradient-text text-lg tracking-tighter">habibiDWL AI</h1>
            <span class="text-[8px] font-black uppercase tracking-[0.2em] opacity-40">Pro Multimodal Engine</span>
        </div>

        <button onclick="toggleDarkMode()" class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 dark:hover:bg-slate-800 transition">
            <i class="fas fa-sun text-reggae-yellow hidden dark:block"></i>
            <i class="fas fa-moon text-reggae-red dark:hidden"></i>
        </button>
    </header>

    <!-- Running Cards Carousel -->
    <div class="fixed top-16 inset-x-0 z-30 card-carousel">
        <div class="card-track">
            <!-- First Set -->
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-bolt text-reggae-yellow"></i>
                <div class="text-[10px] font-bold">Respons Super Cepat</div>
            </div>
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-brain text-reggae-green"></i>
                <div class="text-[10px] font-bold">Akurasi GPT-4o Level</div>
            </div>
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-image text-reggae-red"></i>
                <div class="text-[10px] font-bold">Bisa Analisis Gambar</div>
            </div>
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-music text-blue-500"></i>
                <div class="text-[10px] font-bold">Lirik & Musik Reggae</div>
            </div>
            <!-- Duplicated for Infinite Scroll -->
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-bolt text-reggae-yellow"></i>
                <div class="text-[10px] font-bold">Respons Super Cepat</div>
            </div>
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-brain text-reggae-green"></i>
                <div class="text-[10px] font-bold">Akurasi GPT-4o Level</div>
            </div>
            <div class="info-card flex items-center gap-3">
                <i class="fas fa-image text-reggae-red"></i>
                <div class="text-[10px] font-bold">Bisa Analisis Gambar</div>
            </div>
        </div>
    </div>

    <!-- Chat Space -->
    <main id="chat-viewport" class="chat-container mt-32 px-4 py-6 space-y-6 overflow-y-auto">
        <div id="empty-state" class="flex flex-col items-center justify-center min-h-[50vh] text-center space-y-6">
            <div class="relative w-28 h-28 bg-gradient-to-tr from-green-600 via-yellow-400 to-red-600 rounded-3xl rotate-12 flex items-center justify-center shadow-2xl">
                <i class="fas fa-robot text-white text-5xl -rotate-12"></i>
            </div>
            <div class="px-6">
                <h2 class="text-2xl font-extrabold mb-1">Ada yang bisa Habibi bantu?</h2>
                <p class="text-sm opacity-50">Tulis kode, kirim foto, atau sekadar sapa santai kawan!</p>
            </div>
            <div class="grid grid-cols-2 gap-3 w-full max-w-sm">
                <button onclick="fastAsk('Tolong jelaskan cara coding Python')" class="p-3 text-[11px] bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-2xl shadow-sm hover:scale-105 transition">Belajar Coding</button>
                <button onclick="fastAsk('Buatkan puisi tentang pantai kawan')" class="p-3 text-[11px] bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-2xl shadow-sm hover:scale-105 transition">Buat Puisi</button>
            </div>
        </div>
    </main>

    <!-- Bottom Interface -->
    <footer class="fixed bottom-0 inset-x-0 p-4 pb-8 glass-ui border-t dark:border-slate-800 z-40">
        <!-- File Preview -->
        <div id="file-preview" class="hidden mb-4 p-3 bg-gray-50 dark:bg-slate-800/50 rounded-2xl flex items-center gap-4 border-2 border-dashed border-reggae-yellow animate-pop">
            <div class="relative w-16 h-16 rounded-xl overflow-hidden shadow-lg">
                <img id="preview-img" class="w-full h-full object-cover">
            </div>
            <div class="flex-1">
                <p class="text-[11px] font-extrabold uppercase text-reggae-green">File Gambar Terpilih</p>
                <p class="text-[10px] opacity-60">Siap dikirim ke habibiDWL AI</p>
            </div>
            <button onclick="clearFile()" class="w-10 h-10 bg-reggae-red text-white rounded-full flex items-center justify-center shadow-md active:scale-90">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>

        <div class="max-w-4xl mx-auto flex items-end gap-3">
            <div class="flex-1 bg-white dark:bg-slate-800 rounded-[28px] border dark:border-slate-700 flex items-end p-1.5 shadow-xl transition-all focus-within:ring-2 ring-reggae-yellow/50">
                <button onclick="triggerFile()" class="p-3 text-gray-400 hover:text-reggae-green transition-all">
                    <i class="fas fa-file-image text-xl"></i>
                </button>
                <textarea 
                    id="user-msg" 
                    rows="1" 
                    placeholder="Kirim pesan ke Habibi..." 
                    class="w-full py-3 bg-transparent outline-none resize-none text-sm max-h-40"
                    oninput="resizeTxt(this)"></textarea>
                <button onclick="startMic()" id="mic-btn" class="p-3 text-gray-400 hover:text-reggae-red transition-all">
                    <i class="fas fa-microphone text-xl"></i>
                </button>
            </div>
            <button onclick="onSend()" id="send-btn" class="w-14 h-14 rounded-full bg-gradient-to-br from-green-600 to-green-800 text-white shadow-lg flex items-center justify-center text-xl hover:shadow-green-500/40 transition-all active:scale-90">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        <p class="text-[9px] text-center mt-3 opacity-30 font-medium">Powered by Gemini 2.5 Flash â€¢ Professional Edition</p>
    </footer>

    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleFile(event)">

    <script>
        const apiKey = "";
        let currentFile = null;
        let busy = false;

        // UI
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); }
        function toggleDarkMode() { document.documentElement.classList.toggle('dark'); }
        function resizeTxt(e) { e.style.height = 'auto'; e.style.height = e.scrollHeight + 'px'; }
        function triggerFile() { document.getElementById('file-input').click(); }
        function fastAsk(t) { document.getElementById('user-msg').value = t; onSend(); }

        function handleFile(e) {
            const f = e.target.files[0];
            if (f) {
                const r = new FileReader();
                r.onload = (ev) => {
                    currentFile = ev.target.result.split(',')[1];
                    document.getElementById('preview-img').src = ev.target.result;
                    document.getElementById('file-preview').classList.remove('hidden');
                };
                r.readAsDataURL(f);
            }
        }

        function clearFile() {
            currentFile = null;
            document.getElementById('file-input').value = '';
            document.getElementById('file-preview').classList.add('hidden');
        }

        // Logic
        async function onSend() {
            const input = document.getElementById('user-msg');
            const txt = input.value.trim();
            if ((!txt && !currentFile) || busy) return;

            const empty = document.getElementById('empty-state');
            if (empty) empty.remove();

            appendMsg('user', txt, currentFile);
            
            input.value = '';
            input.style.height = 'auto';
            const fileToSend = currentFile;
            clearFile();

            busy = true;
            toggleBtn(true);
            const botId = appendMsg('bot', '', null, true);

            try {
                const isDrawing = /gambar|lukis|buatkan foto/i.test(txt) && !fileToSend;
                if (isDrawing) {
                    await handleDraw(txt, botId);
                } else {
                    await handleChat(txt, fileToSend, botId);
                }
            } catch (err) {
                document.getElementById(botId).querySelector('.text-box').innerHTML = "Waduh kawan, koneksi Habibi lagi terganggu. Coba sebentar lagi ya!";
            } finally {
                busy = false;
                toggleBtn(false);
            }
        }

        async function handleChat(prompt, img, bId) {
            const box = document.getElementById(bId).querySelector('.text-box');
            const payload = {
                contents: [{
                    parts: [{ text: prompt || "Tolong bantu saya kawan." }]
                }],
                systemInstruction: {
                    parts: [{ text: "Nama kamu adalah habibiDWL AI. Kamu adalah AI profesional, cerdas, akurat, dan sangat membantu. Gaya bicaramu santai seperti budaya reggae (gunakan kata kawan, damai, dll) tapi tetap memberikan jawaban teknis yang sangat tepat dan benar. Jika user bertanya tentang coding atau pengetahuan umum, berikan jawaban selevel ChatGPT Pro." }]
                }
            };

            if (img) payload.contents[0].parts.push({ inlineData: { mimeType: "image/png", data: img } });

            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf kawan, aku terdiam sejenak.";
            
            box.innerHTML = "";
            let i = 0;
            const timer = setInterval(() => {
                box.innerHTML += text[i];
                i++;
                if (i >= text.length) {
                    clearInterval(timer);
                    document.getElementById('chat-viewport').scrollTop = document.getElementById('chat-viewport').scrollHeight;
                }
            }, 10);
        }

        async function handleDraw(prompt, bId) {
            const box = document.getElementById(bId).querySelector('.text-box');
            box.innerHTML = `<p class="italic opacity-60 text-xs">Menyiapkan kanvas dan cat warna...</p><div class="w-full h-48 bg-gray-200 dark:bg-slate-800 rounded-2xl animate-pulse mt-2"></div>`;
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    body: JSON.stringify({ instances: { prompt: prompt }, parameters: { sampleCount: 1 } })
                });
                const data = await res.json();
                const url = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                box.innerHTML = `
                    <div class="space-y-3">
                        <img src="${url}" class="w-full rounded-2xl shadow-xl border-4 border-white dark:border-slate-700">
                        <div class="flex justify-between items-center px-1">
                            <span class="text-[10px] font-bold opacity-50 italic">Lukisan Habibi kawan</span>
                            <a href="${url}" download="habibi-art.png" class="text-xs text-reggae-green font-bold uppercase"><i class="fas fa-save"></i> Simpan</a>
                        </div>
                    </div>`;
            } catch (e) { box.innerHTML = "Gagal melukis kawan, kuasnya hilang!"; }
        }

        function appendMsg(role, txt, img, loading = false) {
            const vp = document.getElementById('chat-viewport');
            const id = 'm-' + Date.now();
            const wrap = document.createElement('div');
            wrap.id = id;
            wrap.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-pop`;

            wrap.innerHTML = `
                <div class="max-w-[85%] ${role === 'user' ? 'bg-gradient-to-r from-green-700 to-green-600 text-white rounded-[24px] rounded-tr-none shadow-md' : 'bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-[24px] rounded-tl-none shadow-sm'} p-4">
                    ${img ? `<img src="data:image/png;base64,${img}" class="w-full h-auto rounded-xl mb-3 border border-black/5">` : ''}
                    <div class="text-box text-sm leading-relaxed whitespace-pre-wrap">${loading ? '<div class="flex gap-1 py-1"><div class="typing-dot bg-reggae-green"></div><div class="typing-dot bg-reggae-yellow" style="animation-delay:0.2s"></div><div class="typing-dot bg-reggae-red" style="animation-delay:0.4s"></div></div>' : txt}</div>
                </div>
            `;
            vp.appendChild(wrap);
            vp.scrollTop = vp.scrollHeight;
            return id;
        }

        function toggleBtn(l) {
            const b = document.getElementById('send-btn');
            b.innerHTML = l ? '<i class="fas fa-circle-notch fa-spin"></i>' : '<i class="fas fa-paper-plane"></i>';
            b.disabled = l;
        }

        function startMic() {
            const m = document.getElementById('mic-btn');
            m.classList.add('text-reggae-red', 'pulse-red');
            setTimeout(() => { m.classList.remove('text-reggae-red', 'pulse-red'); }, 3000);
        }

        document.getElementById('user-msg').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                onSend();
            }
        });
    </script>
</body>
</html>
